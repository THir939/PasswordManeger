<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PasswordManeger Cloud</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,600;9..144,800&family=IBM+Plex+Sans:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg: #f5f2ea;
        --bg-soft: #ece5d8;
        --paper: rgba(255, 255, 255, 0.86);
        --paper-strong: rgba(255, 255, 255, 0.94);
        --line: #d8cfbe;
        --line-strong: #cabda7;
        --ink: #191817;
        --muted: #635a4c;
        --brand: #1e3a5f;
        --brand-2: #395f8f;
        --accent: #c76828;
        --danger: #b33a35;
        --ok: #0e7c68;
        --shadow-soft: 0 20px 40px rgba(35, 28, 20, 0.09);
        --shadow-card: 0 12px 24px rgba(36, 30, 20, 0.08);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "IBM Plex Sans", sans-serif;
        color: var(--ink);
        min-height: 100vh;
        background:
          radial-gradient(1200px 700px at 100% -15%, rgba(83, 127, 179, 0.28), transparent 58%),
          radial-gradient(900px 500px at -10% 10%, rgba(200, 102, 45, 0.15), transparent 60%),
          linear-gradient(160deg, var(--bg) 0%, var(--bg-soft) 100%);
      }

      .wrap {
        width: min(1120px, calc(100% - 2rem));
        margin: 1.6rem auto 2.7rem;
        display: grid;
        gap: 1.1rem;
      }

      .hero,
      .panel {
        border: 1px solid var(--line);
        border-radius: 20px;
        background: var(--paper);
        box-shadow: var(--shadow-soft);
        backdrop-filter: blur(8px);
      }

      .hero {
        position: relative;
        overflow: hidden;
        padding: 1.5rem 1.55rem;
      }

      .hero::after {
        content: "";
        position: absolute;
        right: -12%;
        top: -40%;
        width: 340px;
        height: 340px;
        border-radius: 50%;
        background: radial-gradient(circle at 30% 30%, rgba(31, 97, 163, 0.25), transparent 70%);
        pointer-events: none;
      }

      .hero-grid {
        display: grid;
        gap: 0.9rem;
        grid-template-columns: 1fr auto;
        align-items: center;
      }

      .hero h1 {
        margin: 0.22rem 0 0.45rem;
        font-family: "Fraunces", serif;
        font-size: clamp(1.9rem, 4.5vw, 3rem);
        letter-spacing: 0.01em;
      }

      .hero-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 0.45rem;
      }

      .pill {
        border: 1px solid rgba(31, 58, 95, 0.2);
        background: rgba(255, 255, 255, 0.67);
        border-radius: 999px;
        font-size: 0.78rem;
        color: #334765;
        padding: 0.3rem 0.62rem;
        font-weight: 600;
      }

      .kicker {
        margin: 0;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        color: var(--muted);
        font-size: 0.78rem;
      }

      .sub {
        margin: 0;
        color: var(--muted);
        max-width: 62ch;
      }

      .grid {
        display: grid;
        gap: 1.05rem;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      }

      .panel {
        padding: 1.05rem;
        display: grid;
        gap: 0.78rem;
      }

      .panel h2 {
        margin: 0;
        font-size: 1.05rem;
        letter-spacing: 0.01em;
      }

      label {
        display: grid;
        gap: 0.34rem;
        font-size: 0.9rem;
        font-weight: 700;
      }

      input,
      textarea,
      button {
        font: inherit;
      }

      input,
      textarea {
        width: 100%;
        border: 1px solid #cfc3ad;
        border-radius: 12px;
        padding: 0.62rem 0.72rem;
        background: rgba(255, 255, 255, 0.95);
      }

      input:focus,
      textarea:focus {
        outline: 3px solid rgba(120, 153, 187, 0.32);
        border-color: #6d90bb;
      }

      button {
        border: 1px solid transparent;
        border-radius: 12px;
        padding: 0.64rem 0.88rem;
        background: var(--brand);
        color: #fff;
        cursor: pointer;
        font-weight: 700;
        transition: transform 150ms ease, background 150ms ease, box-shadow 150ms ease;
        box-shadow: 0 6px 14px rgba(30, 58, 95, 0.28);
      }

      button:hover {
        background: var(--brand-2);
        transform: translateY(-1px);
      }

      button:focus-visible {
        outline: 3px solid rgba(120, 153, 187, 0.32);
        outline-offset: 2px;
      }

      button.ghost {
        background: rgba(255, 255, 255, 0.72);
        color: var(--ink);
        border-color: #c7bba6;
        box-shadow: none;
      }

      button.ghost:hover {
        background: rgba(255, 255, 255, 0.98);
      }

      .row {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
      }

      .secret-row {
        display: grid;
        grid-template-columns: minmax(0, 1fr) auto;
        gap: 0.45rem;
      }

      .secret-toggle {
        min-width: 3.6rem;
        padding: 0.54rem 0.62rem;
        font-size: 0.78rem;
      }

      .strength-box {
        display: grid;
        gap: 0.26rem;
      }

      .strength-bar {
        width: 100%;
        height: 0.42rem;
        border-radius: 999px;
        background: #e7ddcc;
        overflow: hidden;
      }

      .strength-fill {
        display: block;
        height: 100%;
        width: 0%;
        border-radius: 999px;
        background: #968360;
        transition: width 160ms ease, background-color 160ms ease;
      }

      .strength-text {
        margin: 0;
        font-size: 0.78rem;
        color: var(--muted);
      }

      .strength-box.is-very-weak .strength-fill {
        background: #b42336;
      }

      .strength-box.is-weak .strength-fill {
        background: #ca8a04;
      }

      .strength-box.is-fair .strength-fill {
        background: #3f8f6f;
      }

      .strength-box.is-strong .strength-fill {
        background: #1f7a82;
      }

      .strength-box.is-very-strong .strength-fill {
        background: #155e75;
      }

      .status {
        margin: 0.1rem 0 0;
        min-height: 1.35rem;
        color: var(--muted);
        background: rgba(255, 255, 255, 0.78);
        border: 1px solid rgba(202, 189, 167, 0.75);
        border-radius: 12px;
        padding: 0.56rem 0.8rem;
        font-size: 0.9rem;
        font-weight: 600;
      }

      .status.ok {
        color: var(--ok);
        border-color: rgba(14, 124, 104, 0.32);
      }

      .status.error {
        color: var(--danger);
        border-color: rgba(179, 58, 53, 0.35);
      }

      .status:empty {
        display: none;
      }

      .mono {
        font-family: ui-monospace, Menlo, monospace;
        white-space: pre-wrap;
        background: #fcfaf5;
        border: 1px dashed #d5cab3;
        border-radius: 12px;
        padding: 0.75rem;
      }

      .hint {
        margin: 0;
        font-size: 0.83rem;
        color: var(--muted);
      }

      .two-col {
        display: grid;
        gap: 0.82rem;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      }

      .account-panel {
        gap: 0.85rem;
      }

      .panel-head {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 0.8rem;
      }

      .summary-grid {
        display: grid;
        gap: 0.74rem;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      }

      .summary-card {
        border: 1px solid var(--line-strong);
        background: var(--paper-strong);
        border-radius: 14px;
        padding: 0.66rem 0.72rem;
        box-shadow: var(--shadow-card);
      }

      .summary-label {
        margin: 0;
        color: var(--muted);
        font-size: 0.76rem;
        letter-spacing: 0.05em;
        text-transform: uppercase;
      }

      .summary-value {
        margin: 0.24rem 0 0;
        font-size: 1rem;
        font-weight: 700;
        word-break: break-word;
      }

      .summary-value.plan-active {
        color: var(--ok);
      }

      .summary-value.plan-inactive {
        color: var(--danger);
      }

      .entitlement-list {
        margin: 0;
        padding: 0;
        list-style: none;
        display: grid;
        gap: 0.55rem;
      }

      .entitlement-item {
        border: 1px solid #ccbfa8;
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.9);
        padding: 0.62rem 0.72rem;
        display: grid;
        gap: 0.32rem;
      }

      .entitlement-head {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        align-items: center;
        gap: 0.35rem;
      }

      .entitlement-source {
        margin: 0;
        font-weight: 700;
      }

      .entitlement-status {
        margin: 0;
        border-radius: 999px;
        padding: 0.15rem 0.55rem;
        font-size: 0.74rem;
        font-weight: 700;
      }

      .entitlement-status.active,
      .entitlement-status.trialing,
      .entitlement-status.grace_period {
        background: rgba(14, 124, 104, 0.15);
        color: #0d6a5d;
      }

      .entitlement-status.inactive,
      .entitlement-status.canceled,
      .entitlement-status.expired,
      .entitlement-status.revoked {
        background: rgba(179, 58, 53, 0.13);
        color: #96302c;
      }

      .entitlement-meta {
        margin: 0;
        color: var(--muted);
        font-size: 0.82rem;
      }

      .empty {
        color: var(--muted);
        font-size: 0.88rem;
      }

      details.raw-details summary {
        cursor: pointer;
        font-weight: 700;
      }

      details.raw-details[open] summary {
        margin-bottom: 0.6rem;
      }

      .panel,
      .hero {
        animation: riseIn 420ms ease both;
      }

      .grid .panel:nth-child(1) {
        animation-delay: 60ms;
      }

      .grid .panel:nth-child(2) {
        animation-delay: 120ms;
      }

      @keyframes riseIn {
        from {
          opacity: 0;
          transform: translateY(8px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @media (prefers-reduced-motion: reduce) {
        .panel,
        .hero {
          animation: none;
        }

        button {
          transition: none;
        }
      }

      @media (max-width: 860px) {
        .hero-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <main class="wrap">
      <section class="hero">
        <div class="hero-grid">
          <div>
            <p class="kicker">Commercial Edition</p>
            <h1>PasswordManeger Cloud Billing</h1>
            <p class="sub">サーバー同期は有料プランのみ有効です。ここで登録・課金・契約管理を行います。</p>
          </div>
          <div class="hero-meta">
            <span class="pill">Entitlement Unified</span>
            <span class="pill">Stripe Connected</span>
            <span class="pill">Emergency Recovery</span>
          </div>
        </div>
      </section>

      <p id="status" class="status" role="status" aria-live="polite"></p>

      <section class="grid">
        <article class="panel">
          <h2>1. 新規登録</h2>
          <label>
            メール
            <input id="register-email" type="email" autocomplete="email" />
          </label>
          <label>
            パスワード（10文字以上）
            <div class="secret-row">
              <input id="register-password" type="password" autocomplete="new-password" />
              <button id="register-password-toggle" type="button" class="ghost secret-toggle" data-target="register-password">表示</button>
            </div>
            <div id="register-password-strength" class="strength-box" aria-live="polite">
              <div class="strength-bar"><span class="strength-fill"></span></div>
              <p class="strength-text">強度: 未入力</p>
            </div>
          </label>
          <button id="register-btn" type="button">アカウント作成</button>
        </article>

        <article class="panel">
          <h2>2. ログイン</h2>
          <label>
            メール
            <input id="login-email" type="email" autocomplete="email" />
          </label>
          <label>
            パスワード
            <div class="secret-row">
              <input id="login-password" type="password" autocomplete="current-password" />
              <button id="login-password-toggle" type="button" class="ghost secret-toggle" data-target="login-password">表示</button>
            </div>
            <div id="login-password-strength" class="strength-box" aria-live="polite">
              <div class="strength-bar"><span class="strength-fill"></span></div>
              <p class="strength-text">強度: 未入力</p>
            </div>
          </label>
          <div class="row">
            <button id="login-btn" type="button">ログイン</button>
            <button id="logout-btn" type="button" class="ghost">ログアウト</button>
          </div>
        </article>
      </section>

      <section class="panel">
        <h2>3. 課金</h2>
        <p class="hint">Stripe Checkoutでサブスク開始し、同期APIの利用権を有効化します。</p>
        <div class="row">
          <button id="checkout-btn" type="button">課金を開始</button>
          <button id="portal-btn" type="button" class="ghost">契約管理を開く</button>
          <button id="emergency-btn" type="button" class="ghost">緊急アクセス（暗号化データ取得）</button>
        </div>
      </section>

      <section class="panel account-panel">
        <div class="panel-head">
          <h2>アカウント状態</h2>
          <button id="refresh-account-btn" type="button" class="ghost">状態を更新</button>
        </div>

        <div id="account-summary" class="summary-grid">
          <article class="summary-card">
            <p class="summary-label">メール</p>
            <p id="summary-email" class="summary-value">未ログイン</p>
          </article>
          <article class="summary-card">
            <p class="summary-label">プラン状態</p>
            <p id="summary-plan" class="summary-value plan-inactive">inactive</p>
          </article>
          <article class="summary-card">
            <p class="summary-label">有料アクセス</p>
            <p id="summary-paid" class="summary-value">いいえ</p>
          </article>
          <article class="summary-card">
            <p class="summary-label">次回期限</p>
            <p id="summary-period" class="summary-value">-</p>
          </article>
        </div>

        <div>
          <h3>利用権ソース</h3>
          <ul id="entitlement-list" class="entitlement-list">
            <li class="empty">未ログイン</li>
          </ul>
        </div>

        <details class="raw-details">
          <summary>生データ（JSON）</summary>
          <pre id="account-box" class="mono">未ログイン</pre>
        </details>
      </section>

      <section class="panel">
        <h2>4. 緊急復旧オプション（鍵分割）</h2>
        <p class="hint">
          復旧キーをブラウザ内で分割し、複数人・複数デバイスに配布できます。サーバーには送信しません。
        </p>
        <div class="two-col">
          <article>
            <label>
              復旧キー（未入力なら自動生成）
              <input id="recovery-secret-input" type="text" placeholder="例: PM-RECOVERY-..." />
            </label>
            <div class="row">
              <button id="recovery-generate-btn" type="button" class="ghost">キー生成</button>
            </div>
            <label>
              分割数（N）
              <input id="share-total-input" type="number" min="2" max="10" value="5" />
            </label>
            <label>
              復元に必要な数（K）
              <input id="share-threshold-input" type="number" min="2" max="10" value="3" />
            </label>
            <div class="row">
              <button id="split-shares-btn" type="button">鍵を分割</button>
              <button id="download-shares-btn" type="button" class="ghost">分割結果を保存</button>
            </div>
            <textarea id="shares-output" rows="10" placeholder="ここに分割結果が表示されます"></textarea>
          </article>
          <article>
            <label>
              復元に使うシェア（1行に1つ）
              <textarea id="shares-input" rows="10" placeholder="PM-SHARE-1:..."></textarea>
            </label>
            <div class="row">
              <button id="recover-secret-btn" type="button">シェアから復元</button>
            </div>
            <pre id="recovered-secret-box" class="mono">未復元</pre>
          </article>
        </div>
      </section>
    </main>

    <script type="module" src="/app.js"></script>
  </body>
</html>
