# PasswordManeger (Chrome拡張版)

このプロジェクトは、**ブラウザ拡張機能として動くマルチプラットフォーム向けパスワードマネージャー**です。

- 対応環境: Chrome / Edge / Brave などの Chromium 系ブラウザ
- 実装方式: Manifest V3 (MV3)
- データ保存先: `chrome.storage.local`（ブラウザ内）
- 暗号方式: PBKDF2 + AES-GCM（Web Crypto API）

---

## 1. 何を作ったか（現時点）

実装済み機能:

1. マスターパスワードで Vault を作成 / 解錠 / ロック
2. ログイン情報の保存・検索・編集・削除
3. クレジットカード、個人情報、セキュアノートの保存
4. パスワード自動生成
5. TOTP（2段階認証コード）生成
6. アクティブサイト向け候補表示 + 自動入力
7. フォーム送信時のログイン候補検出（保存提案）
8. 暗号化バックアップ（JSON）エクスポート / インポート
9. セキュリティ診断（弱い/古い/再利用パスワードの可視化）
10. 自動ロック、クリップボード自動クリア設定

---

## 2. なぜこの設計にしたか

### 2-1. 拡張機能を選んだ理由

理由:
- Webアプリ単体より、ログイン画面に直接アクセスして自動入力できるため
- RoboForm / 1Password の主要体験（ブラウザ統合）に近づけるため

メリット:
- ユーザー体験がよい（入力の手間が減る）
- ブラウザごとの導入が簡単（拡張を読み込むだけ）

デメリット:
- ブラウザAPIの制約が強い
- サイトごとのHTML構造差で自動入力の精度がぶれることがある

### 2-2. ローカル暗号化を選んだ理由

理由:
- まずはサーバー不要で安全性の土台を作るため
- 初学者でも動作を追いやすい構成にするため

メリット:
- サーバー攻撃面が減る
- 実装が比較的シンプル

デメリット:
- デバイス間同期は標準ではできない
- バックアップ管理をユーザー側で行う必要がある

### 2-3. MV3（Manifest V3）を選んだ理由

補足: MV3 は Chrome拡張の新しい標準仕様です。

理由:
- Chromeで今後の主流仕様のため
- セキュリティモデルが改善されているため

メリット:
- 現行Chromeの推奨構成に沿える

デメリット:
- バックグラウンドが常駐しないので状態管理が難しい

---

## 3. 1Password比較（現状）

「1Passwordの全機能」を完全再現するには、以下の未実装領域があります。

実装済み（同系統）:
- ログイン保存
- 自動入力
- パスワード生成
- TOTPコード生成
- セキュリティチェック（簡易Watchtower相当）
- ロック機能
- 暗号化バックアップ

未実装（今後必要）:
- デバイス間リアルタイム同期
- チーム共有Vault / 権限管理
- Passkey（FIDO/WebAuthn）フル管理
- 侵害データベース連携による漏えい検知
- OSレベル生体認証連携（Face ID / Touch ID / Windows Hello）
- 監査ログや企業向け管理機能

結論:
- **今は「個人利用の基盤機能」を実装済み**
- **商用1Password完全同等までは、サーバー基盤と認証・同期機能が追加で必要**

---

## 4. 差別化として入れた機能

1. ローカル完結型のセキュリティ診断（オフラインでも動作）
2. フォーム送信検出による「保存候補キュー」
3. 項目種別（ログイン/カード/個人情報/ノート）を1画面で管理

---

## 5. 使い方

### 5-1. ローカル実行

```bash
git clone https://github.com/THir939/PasswordManeger.git
cd PasswordManeger
npm test
```

### 5-2. Chromeに読み込む

1. `chrome://extensions` を開く
2. 右上の「デベロッパーモード」をON
3. 「パッケージ化されていない拡張機能を読み込む」
4. このプロジェクトフォルダを選択

### 5-3. 初期セットアップ

1. 拡張アイコンをクリック
2. マスターパスワードでVault作成
3. ログイン項目を追加
4. 対応サイトで「このサイト向け候補」から自動入力

---

## 6. ディレクトリ構成

```text
manifest.json
src/
  background.js            # 暗号化保管・状態管理・APIハンドラ
  content-script.js        # 自動入力・フォーム送信検出
  lib/
    crypto.js              # PBKDF2 + AES-GCM
    password.js            # 生成器 + 強度評価
    security-audit.js      # セキュリティ診断
    totp.js                # TOTP生成
  popup/
    popup.html
    popup.css
    popup.js               # メインUI
  options/
    options.html
    options.css
test/
  run-tests.mjs
```

---

## 7. テスト

```bash
npm test
```

テスト内容:
1. 暗号化/復号の往復
2. 間違ったマスターパスワードの失敗確認
3. パスワード生成器の基本検証
4. TOTPの既知ベクトル検証
5. セキュリティ診断ロジック検証

---

## 8. 注意点（重要）

1. マスターパスワードを忘れるとVaultは復元できません。
2. このバージョンはクラウド同期がありません。
3. 自動入力はサイト実装により成功率が変わります。
4. 金融・業務用途の本番利用前には追加の監査が必要です。

---

## 9. 次の拡張候補

1. クラウド同期（E2E暗号化）
2. Passkey管理
3. 侵害検知API連携
4. 共有Vault / 権限管理
5. ネイティブアプリ連携（生体認証）

---

## 10. 詳細設計書

設計の全体像（単体モード + 連携モード）は以下を参照してください。

- `docs/detailed-design-ja.md`
